package cmd

import (
	"log"
	"os"

	"github.com/dwelch0/stackrox-cve-exporter/pkg/exporter"
)

const (
	ACS_ENDPOINT = "ACS_ENDPOINT"
	ACS_TOKEN    = "ACS_TOKEN"
	METRIC_PORT  = "METRIC_PORT"
)

func Run() {
	endpoint := os.Getenv(ACS_ENDPOINT)
	if len(endpoint) < 0 {
		log.Fatalf("Required var missing: %s", ACS_ENDPOINT)
	}
	token := os.Getenv(ACS_TOKEN)
	if len(token) < 0 {
		log.Fatalf("Required var missing: %s", ACS_TOKEN)
	}
	port, set := os.LookupEnv(METRIC_PORT)
	if !set {
		port = "9090"
	}

	stackroxExporter := exporter.NewExporter(
		endpoint,
		token,
		port,
	)

	stackroxExporter.Run()
}
